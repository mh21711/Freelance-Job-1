import{x as N,r as h,z as W,V as k,S as L,_ as $,n as O,ab as R,ac as Y,ad as z,o as E,q as F,a as _,c as y,f as e,b as v,w as C,u as i,t as J,e as I,k as X,I as A,ae as x,K as M,L as P,d as G,v as V,p as q,g as D,D as Q,a6 as H}from"./index-u-RSwE93.js";import{a as w}from"./axios-L6U4YIEh.js";import{u as ee}from"./EmailStore-iKTT0QKx.js";const K=N("socialLogin",()=>{let o=h(!1);const f=W();let l=h(null);function d(t){t&&(t.response.data.non_field_errors?l.value=t.response.data.non_field_errors[0]:t.response.data.detail?l.value=t.response.data.detail:t.value="حدث خطأ !")}function a(t){t.data["jwt token"]&&k.set("jwt",t.data["jwt token"],60*60*24*3),t.data.is_admin?k.set("access",t.data.is_admin,60*60*24*3):k.set("access",!1,60*60*24*3)}function c(){L.fire({title:"تم تسجيل الدخول",text:"سيتم تحويلك الي المحادثة",icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),setTimeout(()=>{f.push("/chat")},2e3)}function p(t){let n=h(t.data.key),b=h(n.value.trim());o.value=!0;const s={Cookie:"jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6MTMsImVtYWlsIjoiYWhtZWRrYW1lbG9mZmljaWFsMUBnbWFpbC5jb20iLCJpc19hZG1pbiI6ZmFsc2UsImVtYWlsX3ZlcmlmaWVkIjp0cnVlfQ.e4jw2qiUMPGVz0mVs7D_B_7pigu4KviqdKYAUfUKjbU; sessionid=wll7kpmy8mrcsdu8nb7jmomnhzb2kfig"},r=new FormData;r.append("token_key",b.value),w.post("https://impactstudio.pythonanywhere.com/api/user/get_data/",r,{headers:s}).then(m=>{a(m),c()}).catch(m=>{d(m)}).finally(()=>{o.value=!1,setTimeout(()=>{l.value=null},5e3)})}function g(t){o.value=!0,w.post("https://impactstudio.pythonanywhere.com/api/user/dj-rest-auth/google/login/",{access_token:t}).then(n=>{p(n)}).catch(n=>{d(n)}).finally(()=>{o.value=!1,setTimeout(()=>{l.value=null},5e3)})}function T(t){o.value=!0,w.post("https://impactstudio.pythonanywhere.com/api/user/linkedin/login/callback/",{code:t}).then(n=>{a(n),c()}).catch(n=>{d(n)}).finally(()=>{o.value=!1,setTimeout(()=>{l.value=null},5e3)})}function j(t,n){o.value=!0,w.post("https://impactstudio.pythonanywhere.com/api/user/twitter/login/callback/",{oauth_token:t,oauth_verifier:n}).then(b=>{a(b),c()}).catch(b=>{d(b)}).finally(()=>{o.value=!1,setTimeout(()=>{l.value=null},5e3)})}return{googleLogin:g,linkedinLogin:T,twitterLogin:j,loading:o,errorMessage:l}}),Z=o=>(q("data-v-433ef66f"),o=o(),D(),o),te={class:"container py-5 h-100"},oe={class:"row d-flex justify-content-center align-items-center h-100"},se={class:"col-12 col-md-8 col-lg-6 col-xl-5"},ae={class:"card shadow-2-strong",style:{"border-radius":"1rem"}},ne={class:"card-body p-5 text-center"},ie=Z(()=>e("h3",{class:"mb-5"},"تسجيل الدخول",-1)),le={class:"error-msg-cont"},re={key:0,style:{color:"red"}},ce={class:"form-outline mb-4"},ue={class:"form-outline mb-4"},de={class:"form-check d-flex justify-content-evenly mb-4"},pe={class:"btn btn-primary btn-lg btn-block",type:"submit"},me={key:0,class:"spinner-border",role:"status"},fe={key:1},he=Z(()=>e("hr",{class:"my-4"},null,-1)),_e={class:"socila-container d-flex justify-content-center"},ge={__name:"TheLogin",setup(o){let f=ee(),l=K();O(z,Y,R);const d=W();let a=h(""),c=h(""),p=h(""),g=h(!1),T=async()=>{try{g.value=!0;const s=await w.post("https://impactstudio.pythonanywhere.com/api/user/login/",{email_or_name:a.value,password:c.value});s.data&&s.data["jwt token"]?s.data.email_verified===!0?(k.set("jwt",s.data["jwt token"],60*60*24*3),k.set("access",s.data.is_admin,60*60*24*3),g.value=!1,s.data.is_admin?(L.fire({title:"تم تسجيل الدخول",text:"سيتم تحويلك الي لوحة التحكم",icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),setTimeout(()=>{d.push("/admin-dashboard"),setTimeout(()=>{location.reload()},300)},2e3)):(L.fire({title:"تم تسجيل الدخول",text:"سيتم تحويلك الي المحادثة",icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),setTimeout(()=>{d.push("/chat")},2e3),setTimeout(()=>{location.reload()},2500)),a.value="",c.value=""):(L.fire({icon:"question",title:"التحقق من البريد الإلكتروني",text:"الرجاء التحقق من بريدك الإلكتروني للحصول على الكود السري"}),f.sendOtp(a.value),a.value="",c.value=""):(g.value=!1,p.value="خطأ غير متوقع")}catch(s){s.response&&s.response.data&&s.response.data.detail?p.value=s.response.data.detail:p.value="حدث خطأ",g.value=!1}};function j(){window.location.href="https://accounts.google.com/o/oauth2/v2/auth?redirect_uri=https://ma3rifah.org/login/&prompt=consent&response_type=token&client_id=1066736221829-vut81ib16avjd3igeptmf8di3ph0fo6o.apps.googleusercontent.com&scope=openid%20email%20profile"}function t(){window.location.href="https://impactstudio.pythonanywhere.com/api/user/linkedin/login/"}function n(){window.location.href="https://impactstudio.pythonanywhere.com/api/user/twitter/login/"}function b(){const s=window.location.href,m=new URLSearchParams(s.split("#")[1]).get("access_token"),u=new URLSearchParams(s.split("?")[1]),B=u.get("code"),S=u.get("oauth_token"),U=u.get("oauth_verifier");m?l.googleLogin(m):B?l.linkedinLogin(B):S&&U&&l.twitterLogin(S,U)}return E(()=>{b()}),(s,r)=>{const m=F("router-link");return _(),y("section",null,[e("div",te,[e("div",oe,[e("div",se,[e("div",ae,[e("div",ne,[ie,e("div",le,[v(X,null,{default:C(()=>[i(p)?(_(),y("p",re,J(i(p)),1)):I("",!0)]),_:1})]),e("form",{onSubmit:r[2]||(r[2]=A(u=>i(T)(),["prevent"])),onInput:r[3]||(r[3]=u=>x(p)?p.value="":p="")},[e("div",ce,[M(e("input",{id:"typeEmailX-2",class:"form-control form-control-lg",placeholder:"البريد الإلكتروني ",required:"","onUpdate:modelValue":r[0]||(r[0]=u=>x(a)?a.value=u:a=u)},null,512),[[P,i(a),void 0,{trim:!0}]])]),e("div",ue,[M(e("input",{type:"password",id:"typePasswordX-2",class:"form-control form-control-lg",placeholder:"كلمة السر",required:"","onUpdate:modelValue":r[1]||(r[1]=u=>x(c)?c.value=u:c=u)},null,512),[[P,i(c),void 0,{trim:!0}]])]),e("div",null,[e("div",de,[v(m,{to:"/forgot-password"},{default:C(()=>[G("إعادة تعيين كلمة المرور")]),_:1}),v(m,{to:"/signup"},{default:C(()=>[G(" إنشاء حساب جديد")]),_:1})])]),e("button",pe,[i(g)?(_(),y("span",me)):(_(),y("span",fe," تسجيل الدخول "))])],32),he,e("div",_e,[e("button",{onClickOnce:j,class:"btn btn-lg btn-block btn-primary mb-2",style:{"background-color":"#dd4b39"},type:"submit"},[v(i(V),{name:"bi-google"})],32),e("button",{onClickOnce:t,class:"btn btn-lg btn-block btn-primary mb-2",style:{"background-color":"#0077b5"},type:"submit"},[e("span",null,[v(i(V),{name:"bi-linkedin"})])],32),e("button",{onClick:n,class:"btn btn-lg btn-block btn-primary mb-2",style:{"background-color":"#1da1f2"},type:"submit"},[e("span",null,[v(i(V),{name:"bi-twitter"})])])])])])])])])])}}},be=$(ge,[["__scopeId","data-v-433ef66f"]]),ve=o=>(q("data-v-305cf9e5"),o=o(),D(),o),ye={class:"position-relative"},we={key:0,class:"alert alert-danger alert-dismissible fade show",role:"alert"},ke={key:0,class:"loader-parent d-flex justify-content-center align-items-center"},Le=ve(()=>e("div",{class:"loader"},null,-1)),Te=[Le],je={__name:"LoginView",setup(o){const f=K();return(l,d)=>(_(),y("section",ye,[i(f).errorMessage?(_(),y("div",we,[e("p",null,J(i(f).errorMessage),1),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"alert","aria-label":"Close",onClick:d[0]||(d[0]=a=>i(f).errorMessage=null)})])):I("",!0),(_(),Q(H,{to:"#app"},[i(f).loading?(_(),y("section",ke,Te)):I("",!0)])),v(be)]))}},Ie=$(je,[["__scopeId","data-v-305cf9e5"]]);export{Ie as default};
